import{_ as a,c as s,o as n,e}from"./app-0TPXc-ei.js";const l={},i=e(`<h1 id="docker安装rabbitmq" tabindex="-1"><a class="header-anchor" href="#docker安装rabbitmq"><span>docker安装rabbitmq</span></a></h1><div class="custom-container tip"><p class="custom-container-title">提示</p><p>以下内容需要有一定的docker基础，并且需要在已经安装了<code>docker</code>环境中运行</p></div><h2 id="安装" tabindex="-1"><a class="header-anchor" href="#安装"><span>安装</span></a></h2><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token function">docker</span> pull rabbitmq</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>这样默认拉取的是<code>latest</code>版本，该版本默认没有管理界面，如果需要管理界面我们可以构建容器后在容器中启用<a href="#%E6%8E%A7%E5%88%B6%E5%8F%B0%E6%8F%92%E4%BB%B6">控制台插件</a></p><p>或者直接拉取<code>management</code>版本</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token function">docker</span> pull rabbitmq:management</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="运行" tabindex="-1"><a class="header-anchor" href="#运行"><span>运行</span></a></h2><h3 id="最小化构建" tabindex="-1"><a class="header-anchor" href="#最小化构建"><span>最小化构建</span></a></h3><p>默认<code>latest</code>版本</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token function">docker</span> run <span class="token parameter variable">--name</span><span class="token operator">=</span>rabbitmq <span class="token parameter variable">-p</span> <span class="token number">15672</span>:15672 <span class="token parameter variable">-p</span> <span class="token number">5672</span>:5672 <span class="token parameter variable">-d</span> rabbitmq</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><code>--name=rabbitmq</code> 容器命名为rabbitmq</li><li><code>-p 15672:15672</code> 将容器的15672端口映射到宿主机的15672端口，<code>15672</code>是管理界面端口</li><li><code>-p 5672:5672</code> 将容器的5672端口映射到宿主机的5672端口，<code>5672</code>是服务端口</li></ul><p>如果我们拉取的是<code>management</code>版本，记得在容器后面加上<code>management</code>标签</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token function">docker</span> run <span class="token parameter variable">--name</span><span class="token operator">=</span>rabbitmq <span class="token parameter variable">-p</span> <span class="token number">15672</span>:15672 <span class="token parameter variable">-p</span> <span class="token number">5672</span>:5672 <span class="token parameter variable">-d</span> rabbitmq:management</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="custom-container warning"><p class="custom-container-title">注意</p><p>如果构建容器时没有加<code>management</code>标签，系统会默认拉取<code>latest</code>版本后再运行</p></div><p>如果是通过<code>management</code>标签构建的容器，现在我们就可以访问<code>http://宿主机ip:15672</code>打开管理控制台界面了，当然如果环境（阿里云）有端口限制还需要先启用<code>15672</code>端口才行</p><h3 id="控制台插件" tabindex="-1"><a class="header-anchor" href="#控制台插件"><span>控制台插件</span></a></h3><p>如果是用默认<code>latest</code>版本构建容器，也是可以打开控制台界面的，进入容器通过命令启用控制台插件，然后重启容器即可</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token comment"># 进入容器</span></span>
<span class="line"><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> rabbitmq /bin/bash</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 启用控制台插件</span></span>
<span class="line">rabbitmq-plugins <span class="token builtin class-name">enable</span> rabbitmq_management</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 退出容器</span></span>
<span class="line"><span class="token builtin class-name">exit</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 重启容器</span></span>
<span class="line"><span class="token function">docker</span> restart rabbitmq</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="初始账号" tabindex="-1"><a class="header-anchor" href="#初始账号"><span>初始账号</span></a></h3><p>如果运行容器时没有设置账号，rabbitmq会给我们创建一个默认账号：<code>guest/guest</code></p><p>如果不想用默认的<code>guest</code>，可以在构建容器时指定其它账号</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token function">docker</span> run <span class="token parameter variable">--name</span><span class="token operator">=</span>rabbitmq <span class="token punctuation">\\</span></span>
<span class="line">    <span class="token parameter variable">-p</span> <span class="token number">15672</span>:15672 <span class="token parameter variable">-p</span> <span class="token number">5672</span>:5672 <span class="token punctuation">\\</span></span>
<span class="line">    <span class="token parameter variable">--restart</span><span class="token operator">=</span>always <span class="token punctuation">\\</span></span>
<span class="line">    <span class="token parameter variable">-e</span> <span class="token assign-left variable">RABBITMQ_DEFAULT_USER</span><span class="token operator">=</span>admin <span class="token punctuation">\\</span></span>
<span class="line">    <span class="token parameter variable">-e</span> <span class="token assign-left variable">RABBITMQ_DEFAULT_PASS</span><span class="token operator">=</span>admin <span class="token punctuation">\\</span></span>
<span class="line">    <span class="token parameter variable">-d</span> rabbitmq</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>-e RABBITMQ_DEFAULT_USER=admin</code> 默认账号为<code>admin</code></li><li><code>-e RABBITMQ_DEFAULT_PASS=admin</code> 默认密码为<code>admin</code></li></ul><div class="custom-container tip"><p class="custom-container-title">提示</p><p>登录进入控制台后，也可以通过<code>Admin</code>菜单添加、更改账户信息</p></div><h3 id="延迟队列" tabindex="-1"><a class="header-anchor" href="#延迟队列"><span>延迟队列</span></a></h3><h4 id="下载插件" tabindex="-1"><a class="header-anchor" href="#下载插件"><span>下载插件</span></a></h4><p>官方插件地址：<a href="https://www.rabbitmq.com/community-plugins.html" target="_blank" rel="noopener noreferrer">https://www.rabbitmq.com/community-plugins.html</a></p><p>找到插件<code>rabbitmq_delayed_message_exchange</code>，进入GitHub下载本地RabbitMQ对应的插件版本（下载.ez文件）</p><p>下载到本地后将文件放置RabbitMQ的plugins目录<code>/opt/rabbitmq/plugins/</code></p><p>这里用的是docker安装rabbitmq，所以将插件下载到本地，然后放到容器<code>plugins</code>目录</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token comment"># rabbitmq：容器服务名</span></span>
<span class="line"><span class="token function">docker</span> <span class="token function">cp</span> /Users/ludangxin/Downloads/rabbitmq_delayed_message_exchange-3.8.9-0199d11c.ez rabbitmq:/opt/rabbitmq/plugins/</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="进入容器" tabindex="-1"><a class="header-anchor" href="#进入容器"><span>进入容器</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> rabbitmq /bin/bash</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="查看现有插件列表" tabindex="-1"><a class="header-anchor" href="#查看现有插件列表"><span>查看现有插件列表</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">rabbitmq-plugins list</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 输出部分内容如下 [E*] = 明确启用; e = 隐式启用</span></span>
<span class="line"><span class="token punctuation">[</span>  <span class="token punctuation">]</span> rabbitmq_amqp1_0                  <span class="token number">3.8</span>.3</span>
<span class="line"><span class="token punctuation">[</span>  <span class="token punctuation">]</span> rabbitmq_auth_backend_cache       <span class="token number">3.8</span>.3</span>
<span class="line"><span class="token punctuation">[</span>  <span class="token punctuation">]</span> rabbitmq_auth_backend_http        <span class="token number">3.8</span>.3</span>
<span class="line"><span class="token punctuation">[</span>  <span class="token punctuation">]</span> rabbitmq_auth_backend_ldap        <span class="token number">3.8</span>.3</span>
<span class="line"><span class="token punctuation">[</span>  <span class="token punctuation">]</span> rabbitmq_auth_backend_oauth2      <span class="token number">3.8</span>.3</span>
<span class="line"><span class="token punctuation">[</span>  <span class="token punctuation">]</span> rabbitmq_auth_mechanism_ssl       <span class="token number">3.8</span>.3</span>
<span class="line"><span class="token punctuation">[</span>  <span class="token punctuation">]</span> rabbitmq_consistent_hash_exchange <span class="token number">3.8</span>.3</span>
<span class="line"><span class="token punctuation">[</span>  <span class="token punctuation">]</span> rabbitmq_event_exchange           <span class="token number">3.8</span>.3</span>
<span class="line"><span class="token punctuation">[</span>  <span class="token punctuation">]</span> rabbitmq_federation               <span class="token number">3.8</span>.3</span>
<span class="line"><span class="token punctuation">[</span>  <span class="token punctuation">]</span> rabbitmq_federation_management    <span class="token number">3.8</span>.3</span>
<span class="line"><span class="token punctuation">[</span>  <span class="token punctuation">]</span> rabbitmq_jms_topic_exchange       <span class="token number">3.8</span>.3</span>
<span class="line"><span class="token punctuation">[</span>E*<span class="token punctuation">]</span> rabbitmq_management               <span class="token number">3.8</span>.3</span>
<span class="line"><span class="token punctuation">[</span>e*<span class="token punctuation">]</span> rabbitmq_management_agent         <span class="token number">3.8</span>.3</span>
<span class="line"><span class="token punctuation">[</span>  <span class="token punctuation">]</span> rabbitmq_mqtt                     <span class="token number">3.8</span>.3</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="启用插件" tabindex="-1"><a class="header-anchor" href="#启用插件"><span>启用插件</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">rabbitmq-plugins <span class="token builtin class-name">enable</span> rabbitmq_delayed_message_exchange</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>再次查看安装列表就有了<code>rabbitmq_delayed_message_exchange</code></p><p>安装完毕后登陆RabbitMQ控制台查看，会发现多了个<code>x-delayed-message</code>类型的<code>Exchange</code></p><h2 id="常见问题" tabindex="-1"><a class="header-anchor" href="#常见问题"><span>常见问题</span></a></h2><p>点击<code>Channels</code>菜单，提示<code>Stats in management UI are disabled on this node</code></p><p>或者</p><p>点击<code>Exchanges</code>菜单，随意点击一个<code>exchange name</code>提示<code>Management API returned status code 500 -</code></p><p>解决办法： 进入容器，进入<code>/etc/rabbitmq/conf.d</code>目录，修改<code>management_agent.disable_metrics_collector.conf</code>文件中的<code>management_agent.disable_metrics_collector = false</code>，然后退出重启容器即可</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token comment"># 进入容器</span></span>
<span class="line"><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> rabbitmq /bin/bash</span>
<span class="line"></span>
<span class="line"><span class="token comment"># cd到以下路径</span></span>
<span class="line"><span class="token builtin class-name">cd</span> /etc/rabbitmq/conf.d/</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 修改 management_agent.disable_metrics_collector = false</span></span>
<span class="line"><span class="token builtin class-name">echo</span> management_agent.disable_metrics_collector <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token operator">&gt;</span> management_agent.disable_metrics_collector.conf</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 退出容器</span></span>
<span class="line"><span class="token builtin class-name">exit</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 重启容器</span></span>
<span class="line"><span class="token function">docker</span> restart rabbitmq</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="相关链接" tabindex="-1"><a class="header-anchor" href="#相关链接"><span>相关链接</span></a></h2><p><a href="https://www.cnblogs.com/ludangxin/p/15302794.html" title="RabbitMQ-延迟队列" target="_blank" rel="noopener noreferrer">RabbitMQ-延迟队列</a></p>`,48),t=[i];function c(p,r){return n(),s("div",null,t)}const o=a(l,[["render",c],["__file","docker-install-rabbitmq.html.vue"]]),m=JSON.parse('{"path":"/docker/instance/docker-install-rabbitmq.html","title":"docker安装rabbitmq","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"安装","slug":"安装","link":"#安装","children":[]},{"level":2,"title":"运行","slug":"运行","link":"#运行","children":[{"level":3,"title":"最小化构建","slug":"最小化构建","link":"#最小化构建","children":[]},{"level":3,"title":"控制台插件","slug":"控制台插件","link":"#控制台插件","children":[]},{"level":3,"title":"初始账号","slug":"初始账号","link":"#初始账号","children":[]},{"level":3,"title":"延迟队列","slug":"延迟队列","link":"#延迟队列","children":[]}]},{"level":2,"title":"常见问题","slug":"常见问题","link":"#常见问题","children":[]},{"level":2,"title":"相关链接","slug":"相关链接","link":"#相关链接","children":[]}],"git":{},"filePathRelative":"docker/instance/docker-install-rabbitmq.md"}');export{o as comp,m as data};
